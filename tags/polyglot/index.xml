<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Polyglot on {code that works}</title>
    <link>https://sadique.io/tags/polyglot/?utm_source=site&amp;utm_medium=feed</link>
    <description>Recent content in Polyglot on {code that works}</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en</language>
    <lastBuildDate>Fri, 06 Apr 2018 05:45:08 +0000</lastBuildDate>
    <atom:link href="https://sadique.io/tags/polyglot/?utm_source=site&amp;utm_medium=feed" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Command line clients for gRPC - polyglot</title>
      <link>https://sadique.io/blog/2018/04/06/command-line-clients-for-grpc-polyglot/?utm_source=site&amp;utm_medium=feed</link>
      <pubDate>Fri, 06 Apr 2018 05:45:08 +0000</pubDate>
      
      <guid>https://sadique.io/blog/2018/04/06/command-line-clients-for-grpc-polyglot/?utm_source=site&amp;utm_medium=feed</guid>
      <description>&lt;p&gt;Polyglot was the second gRPC client that I looked at. One of the things that I liked about it is the fact that it does not need users to generate &lt;code&gt;protoset&lt;/code&gt; files. It generates the protoset files in flight every time it runs. This, combined with the fact that it is written in Java does have a disadvantage - every time the client makes a call, it has to fire up a JVM, generate protosets and make the request.&lt;/p&gt;
&lt;p&gt;You run polyglot by using the distributed polyglot jar. To list all the services available on an endpoint, polyglot can be executed as:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;&amp;gt; java -jar ~/Downloads/polyglot.jar --command=list_services \
  --proto_discovery_root=$PROTO_DISCOVERY_ROOT \
  --deadline_ms=3000
[main] INFO me.dinowernli.grpc.polyglot.Main - Polyglot version: 1.6.0
[main] INFO me.dinowernli.grpc.polyglot.Main - Loaded configuration:

manualflowcontrol.StreamingGreeter -&amp;gt; /Users/sdqali/src/grpc/grpc-java/examples/src/proto/hello_streaming.proto
manualflowcontrol.StreamingGreeter/SayHelloStreaming

routeguide.RouteGuide -&amp;gt; /Users/sdqali/src/grpc/grpc-java/examples/src/proto/route_guide.proto
routeguide.RouteGuide/GetFeature
routeguide.RouteGuide/ListFeatures
routeguide.RouteGuide/RecordRoute
routeguide.RouteGuide/RouteChat

helloworld.Greeter -&amp;gt; /Users/sdqali/src/grpc/grpc-java/examples/src/proto/helloworld.proto
helloworld.Greeter/SayHello
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The command &lt;code&gt;call&lt;/code&gt; can be issued to execute a particular service method:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;echo &amp;quot;{&#39;name&#39;: &#39;World&#39;}&amp;quot; | java -jar ~/Downloads/polyglot.jar --command=call \
  --full_method=helloworld.Greeter/SayHello \
  --endpoint=localhost:50051 \
  --proto_discovery_root=$PROTO_DISCOVERY_ROOT \
  --deadline_ms=3000
[main] INFO me.dinowernli.grpc.polyglot.Main - Polyglot version: 1.6.0
[main] INFO me.dinowernli.grpc.polyglot.Main - Loaded configuration:
[main] INFO me.dinowernli.grpc.polyglot.command.ServiceCall - Creating channel to: localhost:50051
[main] INFO me.dinowernli.grpc.polyglot.command.ServiceCall - Using proto descriptors obtained from protoc
[main] INFO me.dinowernli.grpc.polyglot.command.ServiceCall - Creating dynamic grpc client
[main] INFO me.dinowernli.grpc.polyglot.command.ServiceCall - Making rpc with 1 request(s) to endpoint [localhost:50051]
[main] INFO me.dinowernli.grpc.polyglot.grpc.DynamicGrpcClient - Making unary call
[grpc-default-executor-0] INFO me.dinowernli.grpc.polyglot.io.LoggingStatsWriter - Got response message
{
&amp;quot;message&amp;quot;: &amp;quot;Hello World&amp;quot;
}

[grpc-default-executor-0] INFO me.dinowernli.grpc.polyglot.io.LoggingStatsWriter - Completed rpc with 1 response(s)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Notice how we are passing path to proto files and polyglot executes &lt;code&gt;protoc&lt;/code&gt; on them to get protosets.
With reflection turned ON, we no longer need to provide a path to the proto files.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;echo &amp;quot;{&#39;name&#39;: &#39;World&#39;}&amp;quot; | java -jar ~/Downloads/polyglot.jar --command=call \
  --full_method=helloworld.Greeter/SayHello \
  --endpoint=localhost:50051 \
  --deadline_ms=3000 \
  --use_reflection=true
[main] INFO me.dinowernli.grpc.polyglot.Main - Polyglot version: 1.6.0
[main] INFO me.dinowernli.grpc.polyglot.Main - Loaded configuration:
[main] INFO me.dinowernli.grpc.polyglot.command.ServiceCall - Creating channel to: localhost:50051
[main] INFO me.dinowernli.grpc.polyglot.command.ServiceCall - Using proto descriptors fetched by reflection
[main] INFO me.dinowernli.grpc.polyglot.command.ServiceCall - Creating dynamic grpc client
[main] INFO me.dinowernli.grpc.polyglot.command.ServiceCall - Making rpc with 1 request(s) to endpoint [localhost:50051]
[main] INFO me.dinowernli.grpc.polyglot.grpc.DynamicGrpcClient - Making unary call
[grpc-default-executor-0] INFO me.dinowernli.grpc.polyglot.io.LoggingStatsWriter - Got response message
{
&amp;quot;message&amp;quot;: &amp;quot;Hello World&amp;quot;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;That is nice, except that reflection does not work for listing services.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;java -jar ~/Downloads/polyglot.jar --command=list_services \
  --endpoint=localhost:50051 \
  --deadline_ms=3000 \
  --use_reflection=true
[main] INFO me.dinowernli.grpc.polyglot.Main - Polyglot version: 1.6.0
[main] INFO me.dinowernli.grpc.polyglot.Main - Loaded configuration:
[main] WARN me.dinowernli.grpc.polyglot.Main - Caught top-level exception during command execution
java.lang.IllegalArgumentException: A proto discovery root is required for proto analysis
  at com.google.common.base.Preconditions.checkArgument(Preconditions.java:122)
  at me.dinowernli.grpc.polyglot.protobuf.ProtocInvoker.forConfig(ProtocInvoker.java:36)
  at me.dinowernli.grpc.polyglot.Main.getFileDescriptorSet(Main.java:93)
  at me.dinowernli.grpc.polyglot.Main.main(Main.java:62)
Exception in thread &amp;quot;main&amp;quot; java.lang.RuntimeException: java.lang.IllegalArgumentException: A proto discovery root is required for proto analysis
  at me.dinowernli.grpc.polyglot.Main.main(Main.java:86)
Caused by: java.lang.IllegalArgumentException: A proto discovery root is required for proto analysis
  at com.google.common.base.Preconditions.checkArgument(Preconditions.java:122)
  at me.dinowernli.grpc.polyglot.protobuf.ProtocInvoker.forConfig(ProtocInvoker.java:36)
  at me.dinowernli.grpc.polyglot.Main.getFileDescriptorSet(Main.java:93)
  at me.dinowernli.grpc.polyglot.Main.main(Main.java:62)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This was unexpected, as adding this capability to Polyglot should not be too diffcult, considering that they already support reflection for executing services. This is something that I am interested in implementing.&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>Command line clients for gRPC - grpcurl</title>
      <link>https://sadique.io/blog/2018/04/04/command-line-clients-for-grpc-grpcurl/?utm_source=site&amp;utm_medium=feed</link>
      <pubDate>Wed, 04 Apr 2018 05:40:08 +0000</pubDate>
      
      <guid>https://sadique.io/blog/2018/04/04/command-line-clients-for-grpc-grpcurl/?utm_source=site&amp;utm_medium=feed</guid>
      <description>&lt;p&gt;We are in the middle of considering replacing JSON over HTTP with gRPC for communication between our internal services. One of my concerns about this was how we would be able to debug and poke around things in a world where we will no longer be able to use cURL. I have been looking at cURL like command line utilities we can use to replace most of the capabilities, if not all of cURL. So far, I have looked at &lt;a href=&#34;https://github.com/fullstorydev/grpcurl&#34;&gt;grpcurl&lt;/a&gt;, &lt;a href=&#34;https://github.com/grpc/grpc/blob/master/doc/command_line_tool.md&#34;&gt;grpc_cli&lt;/a&gt; and &lt;a href=&#34;https://github.com/grpc-ecosystem/polyglot&#34;&gt;polyglot&lt;/a&gt; .In these blog posts, we will try and compare these tools.&lt;/p&gt;
&lt;p&gt;In this example, we will be running the example implementations provided by the &lt;a href=&#34;https://github.com/grpc/grpc-java/tree/master/examples&#34;&gt;grpc-java&lt;/a&gt; project and using the command line tools against the services from these examples. We will also be running these services without enabling reflection.&lt;/p&gt;
&lt;h2 id=&#34;grpcurl&#34;&gt;grpcurl&lt;/h2&gt;
&lt;p&gt;One of the things that immediately struck me when I started looking at grpcurl was how neat it&amp;rsquo;s command line interface was, especially in comparison with that of polyglot. grpcurl is written in Go and expects you to provide &lt;code&gt;protoset&lt;/code&gt; files that contain service descriptors exported from the &lt;code&gt;proto&lt;/code&gt; files of the service.&lt;/p&gt;
&lt;p&gt;For example, for the &lt;code&gt;hello-world&lt;/code&gt; service from the examples, the &lt;code&gt;protoset&lt;/code&gt; files can be generated using:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;&amp;gt; pwd
grpc-java/examples/src/main/proto
&amp;gt; protoc --proto_path=./ \
    --descriptor_set_out=helloworld.protoset \
    --include_imports \
    ./helloworld.proto
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This will produce a &lt;code&gt;protoset&lt;/code&gt; file named &lt;code&gt;helloworld.protoset&lt;/code&gt;. Using this, we can now list the services available:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;&amp;gt; grpcurl -protoset ./helloworld.protoset list
helloworld.Greeter
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;We can also list all the methods available in a service:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;&amp;gt; grpcurl -protoset ./helloworld.protoset list helloworld.Greeter
SayHello
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;There is also a describe command that produces description of a service:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;&amp;gt; grpcurl -protoset ./helloworld.protoset describe helloworld.Greeter
helloworld.Greeter is a service:
{
  &amp;quot;name&amp;quot;: &amp;quot;Greeter&amp;quot;,
  &amp;quot;method&amp;quot;: [
    {
      &amp;quot;name&amp;quot;: &amp;quot;SayHello&amp;quot;,
      &amp;quot;inputType&amp;quot;: &amp;quot;.helloworld.HelloRequest&amp;quot;,
      &amp;quot;outputType&amp;quot;: &amp;quot;.helloworld.HelloReply&amp;quot;,
      &amp;quot;options&amp;quot;: {

      }
    }
  ],
  &amp;quot;options&amp;quot;: {

  }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now we can execute the method on this service running on a server by specifying the address and the path to the method:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;&amp;gt; grpcurl -plaintext -protoset ./helloworld.protoset -d &#39;{&amp;quot;name&amp;quot;:&amp;quot;World&amp;quot;}&#39; localhost:50051 helloworld.Greeter/SayHello
{
  &amp;quot;message&amp;quot;: &amp;quot;Hello World&amp;quot;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;It can also read the JSON data to pass to the server from STDIN, by setting the value of &lt;code&gt;-d&lt;/code&gt; to &lt;code&gt;@&lt;/code&gt;:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;&amp;gt; echo &#39;{&amp;quot;name&amp;quot;: &amp;quot;World&amp;quot;}&#39; | grpcurl -plaintext -protoset ./helloworld.protoset -d @ localhost:50051 helloworld.Greeter/SayHello
{
  &amp;quot;message&amp;quot;: &amp;quot;Hello World&amp;quot;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;In both these examples, we passed the &lt;code&gt;-plaintext&lt;/code&gt; switch because our server is not running with TLS.&lt;/p&gt;
&lt;p&gt;If we were to &lt;a href=&#34;https://github.com/grpc/grpc-java/blob/master/documentation/server-reflection-tutorial.md&#34;&gt;turn on reflection&lt;/a&gt;, we will no longer need to depend on the &lt;code&gt;protoset&lt;/code&gt; file.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;&amp;gt; echo &#39;{&amp;quot;name&amp;quot;: &amp;quot;World&amp;quot;}&#39; | grpcurl -plaintext -d @ localhost:50051 helloworld.Greeter/SayHello
{
  &amp;quot;message&amp;quot;: &amp;quot;Hello World&amp;quot;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Overall, I like what the creator of grpcurl have done. The only thing I dont like is the fact that when reflection is turned off, we have to generate &lt;code&gt;protoset&lt;/code&gt; files. It would have been great if it could just look at the existing &lt;code&gt;proto&lt;/code&gt; files, which is what &lt;code&gt;polyglot&lt;/code&gt; does. We will look at polyglot in the next blog post.&lt;/p&gt;</description>
    </item>
    
  </channel>
</rss>
