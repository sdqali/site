<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Git on {code that works}</title>
    <link>https://sadique.io/categories/git/?utm_source=site&amp;utm_medium=feed</link>
    <description>Recent content in Git on {code that works}</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en</language>
    <lastBuildDate>Mon, 29 Apr 2013 00:00:00 +0000</lastBuildDate>
    <atom:link href="https://sadique.io/categories/git/?utm_source=site&amp;utm_medium=feed" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Emacs hack: Viewing Git logs while composing commit messages</title>
      <link>https://sadique.io/blog/2013/04/29/emacs-hack-viewing-git-logs-while-composing-commit-messages/?utm_source=site&amp;utm_medium=feed</link>
      <pubDate>Mon, 29 Apr 2013 00:00:00 +0000</pubDate>
      
      <guid>https://sadique.io/blog/2013/04/29/emacs-hack-viewing-git-logs-while-composing-commit-messages/?utm_source=site&amp;utm_medium=feed</guid>
      <description>&lt;p&gt;I use Emacs as my editor to compose Git commit messages. I almost never commit from the terminal with &lt;code&gt;git commit -m&lt;/code&gt;. This approach has two advantages: I get a chance to verify what is being committed and get to compose the message using a proper editor complete with spell checking provided by &lt;em&gt;flyspell mode&lt;/em&gt;. One thing I wish I had access to while composing commit messages is the git log. This is useful to refer to work items and encourages one to use a consistent style in the messages. This was easier in the terminal as one could do something like &lt;code&gt;git log -n 3&lt;/code&gt; and then commit with the &lt;code&gt;-m&lt;/code&gt; flag.&lt;/p&gt;
&lt;p&gt;I decided to fix this today and some tinkering later came up with a hack tp do this.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Git commit messages are stored in the &lt;code&gt;COMMIT_EDITMSG&lt;/code&gt; file under &lt;code&gt;.git/&lt;/code&gt;. So the first thing to do is to ensure that this file always gets loaded with a custom minor mode. This can be done as follows:&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-cl&#34;&gt;(add-to-list &#39;auto-mode-alist &#39;(&amp;quot;\\COMMIT_EDITMSG\\&#39;&amp;quot; . load-magit-log-when-committing-mode))
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The minor mode does not need to do anything. The definition would be like this:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-cl&#34;&gt;(define-minor-mode load-magit-log-when-committing-mode
  &amp;quot;dummy&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;Next step is to add a custom hook that gets run after loading the minor mode. This hook calls the function to load git logs. The code for this is:&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-cl&#34;&gt;(add-hook &#39;load-magit-log-when-committing-mode-hook &#39;show-magit-log-hook)
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;The actual function to load git logs. It calls &lt;code&gt;magit-log&lt;/code&gt; to load the logs and then opens the original &lt;code&gt;COMMIT_EDITMSG&lt;/code&gt; in the other frame.&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-cl&#34;&gt;(defun show-magit-log-hook ()
  (cd &amp;quot;..&amp;quot;)
  (magit-log)
  (switch-to-buffer-other-window &amp;quot;COMMIT_EDITMSG&amp;quot;))
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This is how Emacs looks while committing with this hack in place:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://sadique.io/images/screenshot_git_commit_log.png&#34; alt=&#34;&amp;ldquo;Screenshot showing git commit log&amp;rdquo;&#34; title=&#34;Screenshot showing git commit log&#34;&gt;&lt;/p&gt;
&lt;p&gt;If you want to use this, copy the following snippet to your &lt;code&gt;init.el&lt;/code&gt;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-cl&#34;&gt;;; load-magit-log-when-committing-mode
(define-minor-mode load-magit-log-when-committing-mode
  &amp;quot;dummy&amp;quot;)

;; the hook
(defun show-magit-log-hook ()
  (cd &amp;quot;..&amp;quot;)
  (magit-log)
  (switch-to-buffer-other-window &amp;quot;COMMIT_EDITMSG&amp;quot;))

;; add the hook
(add-hook &#39;load-magit-log-when-committing-mode-hook &#39;show-magit-log-hook)

;; load the mode for commit message
(add-to-list &#39;auto-mode-alist &#39;(&amp;quot;\\COMMIT_EDITMSG\\&#39;&amp;quot; . load-magit-log-when-committing-mode))
&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
    <item>
      <title>Configure Git&#39;s comment character</title>
      <link>https://sadique.io/blog/2013/04/14/configure-gits-comment-character/?utm_source=site&amp;utm_medium=feed</link>
      <pubDate>Sun, 14 Apr 2013 00:00:00 +0000</pubDate>
      
      <guid>https://sadique.io/blog/2013/04/14/configure-gits-comment-character/?utm_source=site&amp;utm_medium=feed</guid>
      <description>&lt;p&gt;TL;DR -
Use the &lt;code&gt;core.commentchar&lt;/code&gt; configuration to change the character Git uses to mark comment lines in commit messages.&lt;/p&gt;
&lt;p&gt;My team has a convention of putting the number of the current Issue/Ticket/Story that we are working on at the beginning of every commit message. This is great because it lets us make sense of the history of our code by helping us answer&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;What were the changes made to the code base to build a feature or fix an issue?&lt;/li&gt;
&lt;li&gt;Given a changeset, why was it put in place?&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;We use the format &lt;code&gt;#123 Foo bar&lt;/code&gt; for the message where &lt;code&gt;123&lt;/code&gt; is the issue number because it lets &lt;a href=&#34;http://www.thoughtworks-studios.com/mingle&#34;&gt;Mingle&lt;/a&gt;, our project management tool track the commits made against each card.&lt;/p&gt;
&lt;p&gt;Things work fine, except for me. I almost never use &lt;code&gt;git ci -m&lt;/code&gt;. I like Git to open up an editor (almost always Emacs), and type my comment message out. But if I type the commit message according to the convention, because the line starts with a &lt;code&gt;#&lt;/code&gt;, Git would treat it as a comment and the commit will be aborted.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-text&#34;&gt;#123 Foobar
# Please enter the commit message for your changes. Lines starting
# with &#39;#&#39; will be ignored, and an empty message aborts the commit.
# On branch source
#
# Changes to be committed:
#   (use &amp;quot;git reset HEAD &amp;lt;file&amp;gt;...&amp;quot; to unstage)
...
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I have been getting around this issue by pre-pending a space before the message. So I was really happy to see that Git &lt;code&gt;1.8.2&lt;/code&gt; ships with a new configuration &lt;code&gt;core.commentchar&lt;/code&gt;. This let&amp;rsquo;s you configure the characters that marks a comment in the commit message. From the &lt;a href=&#34;http://git-scm.com/docs/git-config&#34;&gt;doc&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;core.commentchar&lt;/p&gt;
&lt;p&gt;Commands such as commit and tag that lets you edit messages consider a line that begins with this character commented, and removes them after the editor returns (default #).&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;So with this set to &lt;code&gt;$&lt;/code&gt;, I can just type in my commit message.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-text&#34;&gt;#123 Foobar
$ Please enter the commit message for your changes. Lines starting
$ with &#39;$&#39; will be ignored, and an empty message aborts the commit.
$ On branch source
$
$ Changes to be committed:
$   (use &amp;quot;git reset HEAD &amp;lt;file&amp;gt;...&amp;quot; to unstage)
...
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This configuration is available only in versions &lt;code&gt;1.8.2&lt;/code&gt; and later.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Finding un-merged commits with git cherry</title>
      <link>https://sadique.io/blog/2012/04/29/finding-un-merged-commits-with-git-cherry/?utm_source=site&amp;utm_medium=feed</link>
      <pubDate>Sun, 29 Apr 2012 00:00:00 +0000</pubDate>
      
      <guid>https://sadique.io/blog/2012/04/29/finding-un-merged-commits-with-git-cherry/?utm_source=site&amp;utm_medium=feed</guid>
      <description>&lt;p&gt;In a project that I was a part of in the recent past, we used Story Branching. While it afforded us flexibility in pulling and pushing stories in and out of releases, it has given us some scares in the past. Somebody makes commits against a story, but the commit does not get merged to the correct release branch where it is supposed to go or gets merged to another release. The solution was to hunt down the commits that are missing or have creeped in.&lt;/p&gt;
&lt;p&gt;This is where the &lt;a href=&#34;http://linux.die.net/man/1/git-cherry&#34;&gt;git cherry&lt;/a&gt; command is useful. Git cherry finds commits not merged from a branch to another. From the man page:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Every commit that doesn&amp;rsquo;t exist in the upstream branch has its id (sha1) reported, prefixed by a symbol. The ones that have equivalent change already in the upstream branch are prefixed with a minus (-) sign, and those that only exist in the head branch are prefixed with a plus (+) symbol&amp;quot;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Consider the following example. I have two branches - &lt;code&gt;master&lt;/code&gt; and &lt;code&gt;release-23&lt;/code&gt;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;┌─[sdqali][bihzad][±][master ✓][~/src/play/git_cherry_sandbox]
└─➞  git branch
* master
  release-23
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The branch &lt;code&gt;release-23&lt;/code&gt; has three commits:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;┌─[sdqali][bihzad][±][release-23 ✓][~/src/play/git_cherry_sandbox]
└─➞  git checkout release-23
Already on &#39;release-23&#39;
┌─[sdqali][bihzad][±][release-23 ✓][~/src/play/git_cherry_sandbox]
└─➞  git log
commit f06e4df25724ad0dd51702a10f075d39368e1963
Author: Sadique Ali &amp;lt;sdqali@bihzad.(none)&amp;gt;
Date:   Sun Apr 29 16:51:14 2012 +0530

    Added zoom

commit 2a446b1a19253a69c4bb133eedb311c14b2906e8
Author: Sadique Ali &amp;lt;sdqali@bihzad.(none)&amp;gt;
Date:   Sun Apr 29 16:49:25 2012 +0530

    Added bar

commit 1afda04ccbf2f834663ca8ec3eaf6e3b917581fb
Author: Sadique Ali &amp;lt;sdqali@bihzad.(none)&amp;gt;
Date:   Sun Apr 29 16:48:05 2012 +0530

    Added foo
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The branch &lt;code&gt;master&lt;/code&gt; have two commits:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;┌─[sdqali][bihzad][±][release-23 ✓][~/src/play/git_cherry_sandbox]
└─➞  git checkout master
Switched to branch &#39;master&#39;
┌─[sdqali][bihzad][±][master ✓][~/src/play/git_cherry_sandbox]
└─➞  git log
commit 8c71e1b2232c1a524e1de20553180676fb971f86
Author: Sadique Ali &amp;lt;sdqali@bihzad.(none)&amp;gt;
Date:   Sun Apr 29 16:49:25 2012 +0530

    Amended. This was Added bar

commit 1afda04ccbf2f834663ca8ec3eaf6e3b917581fb
Author: Sadique Ali &amp;lt;sdqali@bihzad.(none)&amp;gt;
Date:   Sun Apr 29 16:48:05 2012 +0530

    Added foo
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;Commit &lt;code&gt;1afda04ccbf2f834663ca8ec3eaf6e3b917581fb (Added foo)&lt;/code&gt; is present in both branches.&lt;/li&gt;
&lt;li&gt;Commit &lt;code&gt;2a446b1a19253a69c4bb133eedb311c14b2906e8 (Added bar)&lt;/code&gt; in the release-23 branch was merged to master, but the commit message was later ammended and its sha became &lt;code&gt;8c71e1b2232c1a524e1de20553180676fb971f86 (Amended. This was Added bar)&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Commit &lt;code&gt;f06e4df25724ad0dd51702a10f075d39368e1963 (Added zoom)&lt;/code&gt; is present only in the release-23 branch.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;If we do a &lt;code&gt;git cherry&lt;/code&gt; now with master as the upstream and &lt;code&gt;release-23&lt;/code&gt; as head:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;┌─[sdqali][bihzad][±][master ✓][~/src/play/git_cherry_sandbox]
└─➞  git cherry master release-23 -v
- 2a446b1a19253a69c4bb133eedb311c14b2906e8 Added bar
+ f06e4df25724ad0dd51702a10f075d39368e1963 Added zoom
&amp;lt;script src=&amp;quot;https://gist.github.com/2549897.js?file=gistfile1.sh&amp;quot;&amp;gt;&amp;lt;/script&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This tells us that&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;An equivalent of commit &lt;code&gt;2a446b1a19253a69c4bb133eedb311c14b2906e8 (Added bar)&lt;/code&gt; is present in the master branch, as indicated by the (-) sign.&lt;/li&gt;
&lt;li&gt;Commit &lt;code&gt;f06e4df25724ad0dd51702a10f075d39368e1963 (Added zoom)&lt;/code&gt; is present only in the release-23 branch, as indicated by the (+) sign.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;If we were to do &lt;code&gt;&amp;lt;b&amp;gt;git cherry&amp;lt;/b&amp;gt;&lt;/code&gt; the other way around, ie. with release-23 as the upstream and master as the head:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;┌─[sdqali][bihzad][±][master ✓][~/src/play/git_cherry_sandbox]
└─➞  git cherry release-23 master -v
- 8c71e1b2232c1a524e1de20553180676fb971f86 Amended. This was Added bar
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This tells us that&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;An equivalent of commit &lt;code&gt;8c71e1b2232c1a524e1de20553180676fb971f86 (Amended. This was Added bar)&lt;/code&gt; is present in the master branch, as indicated by the (-) sign.&lt;/li&gt;
&lt;li&gt;There are no commits in &lt;code&gt;master&lt;/code&gt; that are not present in &lt;code&gt;release-23&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;That is pretty much what the &lt;code&gt;git cherry&lt;/code&gt; command does.&lt;/p&gt;</description>
    </item>
    
  </channel>
</rss>
